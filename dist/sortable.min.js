!function(a){"use strict";var b=["$scope","$attrs","$element","$parse",function(b,c,d,e){this.events={},this.eventSortRequired={},this.registerEvent=function(a,b,c){void 0===c&&(c=0),void 0===this.events[a]&&(this.events[a]=[]),this.events[a].push({priority:c,callback:b}),this.eventSortRequired[a]=!0},this.triggerEvent=function(b,c,d){if(a.isArray(this.events[b])){this.eventSortRequired[b]&&(this.events[b].sort(function(a,b){return a.priority<b.priority}),this.eventSortRequired[b]=!1);for(var e=0;e<this.events[b].length;e++)this.events[b][e].callback(c,d)}};var f=d.contents().filter(function(){return 8===this.nodeType&&this.nodeValue.match(/^[\s]*ngRepeat:/)});if(!f.length)throw new Error("Required ng-repeat not found");var g,h,i,j,k=f[0].nodeValue.split(":").splice(1).join(":"),l=k.match(/^\s*(.+)\s+in\s+(.*)\s*$/);if(!l)throw new Error("Expected ngRepeat in form of '_item_ in _collection_' but got '"+k+"'.");if(g=l[1],h=l[2],l=g.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),!l)throw new Error("'item' in 'item in collection' should be identifier or (key, value) but got '"+g+"'.");if(void 0===l[1])throw new Error("Cannot sort objects; '(key, value)' in collection form not supported");i=h.match(/\|[\s]*orderBy:([^|]*)(\||$)/),i&&b.$watch(i[1],function(a){a?d.sortable("disable"):d.sortable("enable")}),this.valueIdent=l[3]||l[1],j=l[2],this.collectionGetter=e(h.split("|")[0]),this.getCollection=function(){return this.collectionGetter(b)}}];a.module("uis").directive("uisSortable",[function(){return{priority:-1,controller:b,link:function(b,c,d,e){var f,g,h,i,j,k;k=a.extend({},b.$eval(d.uisSortable)),h=function(b,c){for(var d,f=a.element(c.item),g=f.scope()[e.valueIdent],h=0;h<e.getCollection().length;h++)e.getCollection()[h]===g&&(d=h);var i={index:d,sortingItems:[{index:d,element:f,item:g}]};c.item.data("uisSortable",i)},j=function(a,b){b.item.data("uisSortable").resort=!0},f=function(c,d){var f,g,h=d.item.data("uisSortable");for(h.relocate=!0,f=h.sortingItems.length-1;f>=0;f--)if(h.sortingItems[f].index===h.index){g=m(h.sortingItems[f].element,h.index);break}for(f=0;f<h.sortingItems.length;f++)e.getCollection().splice(g+f,0,h.sortingItems[f].item);e.collectionGetter.assign(b,a.copy(e.getCollection()))},g=function(a,b){var c,d=b.item.data("uisSortable");for(d.sortingItems.sort(function(a,b){return a.index>b.index}),d.moved=[],c=d.sortingItems.length-1;c>=0;c--)d.moved.push(e.getCollection().splice(d.sortingItems[c].index,1)[0])},i=function(a,c){var d=c.item.data("uisSortable");if(d.resort&&!d.relocate){var f,g,h;for(d.sortingItems.sort(function(a,b){return a.index>b.index}),g=d.sortingItems.length-1;g>=0;g--)d.sortingItems[g].index===d.index&&(h=g),e.getCollection().splice(d.sortingItems[g].index,1);for(f=m(d.sortingItems[h].element,d.sortingItems[h].index),g=0;g<d.sortingItems.length;g++)e.getCollection().splice(f+g,0,d.sortingItems[g].item);e.collectionGetter.assign(b,e.getCollection())}(d.resort||d.relocate)&&b.$apply()},e.registerEvent("start",h),"function"==typeof k.start&&e.registerEvent("start",k.start),k.start=function(a,b){e.triggerEvent("start",a,b)},e.registerEvent("stop",i),"function"==typeof k.stop&&e.registerEvent("stop",k.stop),k.stop=function(a,b){e.triggerEvent("stop",a,b)},e.registerEvent("update",j),"function"==typeof k.update&&e.registerEvent("update",k.update),k.update=function(a,b){e.triggerEvent("update",a,b)},e.registerEvent("remove",g),"function"==typeof k.remove&&e.registerEvent("remove",k.remove),k.remove=function(a,b){e.triggerEvent("remove",a,b)},e.registerEvent("receive",f),"function"==typeof k.receive&&e.registerEvent("receive",k.receive),k.receive=function(a,b){e.triggerEvent("receive",a,b)},k.deactivate=function(a,b){e.triggerEvent("deactivate",a,b)},c.sortable(k);var l=function(){var a=["[ng-repeat]","[ng\\:repeat]","[ng_repeat]","[x-ng-repeat]","[data-ng-repeat]",'[class^="ng-repeat"]'];return a.join(",")},m=function(b){var c,d,f,g=l(),h=!0,i=e.getCollection();for(d=b.prev(g);d.length&&d.hasClass("ui-selected");)d=d.prev(g);if(!d.length){for(d=b.next(g);d.length&&d.hasClass("ui-selected");)d=d.next(g);h=!1}if(0===d.length)return 0;for(d=a.element(d).scope()[e.valueIdent],f=0;f<i.length;f++)if(i[f]===d){c=f,h&&c++;break}return c}}}}])}(angular);